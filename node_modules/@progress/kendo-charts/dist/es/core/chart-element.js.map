{"version":3,"file":"chart-element.js","sources":["chart-element.js"],"sourcesContent":["import { drawing as draw } from '@progress/kendo-drawing';\n\nimport { WHITE } from '../common/constants';\nimport { Class, deepExtend, defined, valueOrDefault } from '../common';\n\nclass ChartElement extends Class {\n    constructor(options) {\n        super();\n\n        this.children = [];\n\n        this.options = deepExtend({}, this.options, options);\n    }\n\n    reflow(targetBox) {\n        const children = this.children;\n        let box;\n\n        for (let i = 0; i < children.length; i++) {\n            let currentChild = children[i];\n            currentChild.reflow(targetBox);\n\n            box = box ? box.wrap(currentChild.box) : currentChild.box.clone();\n        }\n\n        this.box = box || targetBox;\n    }\n\n    destroy() {\n        const children = this.children;\n\n        if (this.animation) {\n            this.animation.destroy();\n        }\n\n        for (let i = 0; i < children.length; i++) {\n            children[i].destroy();\n        }\n    }\n\n    getRoot() {\n        const parent = this.parent;\n\n        return parent ? parent.getRoot() : null;\n    }\n\n    getSender() {\n        const service = this.getService();\n        if (service) {\n            return service.sender;\n        }\n    }\n\n    getService() {\n        let element = this;\n        while (element) {\n            if (element.chartService) {\n                return element.chartService;\n            }\n            element = element.parent;\n        }\n    }\n\n    translateChildren(dx, dy) {\n        const children = this.children;\n        const childrenCount = children.length;\n\n        for (let i = 0; i < childrenCount; i++) {\n            children[i].box.translate(dx, dy);\n        }\n    }\n\n    append() {\n        for (let i = 0; i < arguments.length; i++) {\n            let item = arguments[i];\n            this.children.push(item);\n            item.parent = this;\n        }\n    }\n\n    renderVisual() {\n        if (this.options.visible === false) {\n            return;\n        }\n\n        this.createVisual();\n\n        this.addVisual();\n\n        this.renderChildren();\n\n        this.createAnimation();\n        this.renderComplete();\n    }\n\n    addVisual() {\n        if (this.visual) {\n            this.visual.chartElement = this;\n\n            if (this.parent) {\n                this.parent.appendVisual(this.visual);\n            }\n        }\n    }\n\n    renderChildren() {\n        const children = this.children;\n        const length = children.length;\n        for (let i = 0; i < length; i++) {\n            children[i].renderVisual();\n        }\n    }\n\n    createVisual() {\n        this.visual = new draw.Group({\n            zIndex: this.options.zIndex,\n            visible: valueOrDefault(this.options.visible, true)\n        });\n    }\n\n    createAnimation() {\n        if (this.visual) {\n            this.animation = draw.Animation.create(\n                this.visual, this.options.animation\n            );\n        }\n    }\n\n    appendVisual(childVisual) {\n        if (!childVisual.chartElement) {\n            childVisual.chartElement = this;\n        }\n\n        if (childVisual.options.noclip) {\n            this.clipRoot().visual.append(childVisual);\n        } else if (defined(childVisual.options.zIndex)) {\n            this.stackRoot().stackVisual(childVisual);\n        } else if (this.isStackRoot) {\n            this.stackVisual(childVisual);\n        } else if (this.visual) {\n            this.visual.append(childVisual);\n        } else {\n            // Allow chart elements without visuals to\n            // pass through child visuals\n            this.parent.appendVisual(childVisual);\n        }\n    }\n\n    clipRoot() {\n        if (this.parent) {\n            return this.parent.clipRoot();\n        }\n\n        return this;\n    }\n\n    stackRoot() {\n        if (this.parent) {\n            return this.parent.stackRoot();\n        }\n\n        return this;\n    }\n\n    stackVisual(childVisual) {\n        const zIndex = childVisual.options.zIndex || 0;\n        const visuals = this.visual.children;\n        const length = visuals.length;\n        let pos;\n\n        for (pos = 0; pos < length; pos++) {\n            let sibling = visuals[pos];\n            let here = valueOrDefault(sibling.options.zIndex, 0);\n            if (here > zIndex) {\n                break;\n            }\n        }\n\n        this.visual.insert(pos, childVisual);\n    }\n\n    traverse(callback) {\n        const children = this.children;\n        const length = children.length;\n\n        for (let i = 0; i < length; i++) {\n            let child = children[i];\n\n            callback(child);\n            if (child.traverse) {\n                child.traverse(callback);\n            }\n        }\n    }\n\n    closest(match) {\n        let element = this;\n        let matched = false;\n\n        while (element && !matched) {\n            matched = match(element);\n\n            if (!matched) {\n                element = element.parent;\n            }\n        }\n\n        if (matched) {\n            return element;\n        }\n    }\n\n    renderComplete() {}\n\n    hasHighlight() {\n        const options = (this.options || {}).highlight;\n        return !(!this.createHighlight || (options && options.visible === false));\n    }\n\n    toggleHighlight(show) {\n        const options = (this.options || {}).highlight;\n        const customVisual = (options || {}).visual;\n        let highlight = this._highlight;\n\n        if (!highlight) {\n            const highlightOptions = {\n                fill: {\n                    color: WHITE,\n                    opacity: 0.2\n                },\n                stroke: {\n                    color: WHITE,\n                    width: 1,\n                    opacity: 0.2\n                }\n            };\n\n            if (customVisual) {\n                highlight = this._highlight = customVisual(\n                    Object.assign(this.highlightVisualArgs(), {\n                        createVisual: () => this.createHighlight(highlightOptions),\n                        sender: this.getSender(),\n                        series: this.series,\n                        dataItem: this.dataItem,\n                        category: this.category,\n                        value: this.value,\n                        percentage: this.percentage,\n                        runningTotal: this.runningTotal,\n                        total: this.total\n                    }\n                ));\n\n                if (!highlight) {\n                    return;\n                }\n            } else {\n                highlight = this._highlight = this.createHighlight(highlightOptions);\n            }\n\n            highlight.options.zIndex = this.options.zIndex;\n            this.appendVisual(highlight);\n        }\n\n        highlight.visible(show);\n    }\n\n    createGradientOverlay(element, options, gradientOptions) {\n        const overlay = new draw.Path(Object.assign({\n            stroke: {\n                color: \"none\"\n            },\n            fill: this.createGradient(gradientOptions),\n            closed: element.options.closed\n        }, options));\n\n        overlay.segments.elements(element.segments.elements());\n\n        return overlay;\n    }\n\n    createGradient(options) {\n        if (this.parent) {\n            return this.parent.createGradient(options);\n        }\n    }\n}\n\nChartElement.prototype.options = { };\n\nexport default ChartElement;"],"names":["super","const","let","arguments","this"],"mappings":"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"}