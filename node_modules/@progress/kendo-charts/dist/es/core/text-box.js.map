{"version":3,"file":"text-box.js","sources":["text-box.js"],"sourcesContent":["import { drawing as draw, geometry as geom } from '@progress/kendo-drawing';\n\nimport BoxElement from './box-element';\nimport FloatElement from './float-element';\nimport Text from './text';\nimport Box from './box';\n\nimport rectToBox from './utils/rect-to-box';\n\nimport { getSpacing, deepExtend } from '../common';\nimport { X, Y } from '../common/constants';\n\nconst ROWS_SPLIT_REGEX = /\\n|\\\\n/m;\n\nclass TextBox extends BoxElement {\n\n    constructor(content, options) {\n        super(options);\n        this.content = content;\n\n        this._initContainer();\n        if (this.options._autoReflow !== false) {\n            this.reflow(new Box());\n        }\n    }\n\n    _initContainer() {\n        const options = this.options;\n        const rows = String(this.content).split(ROWS_SPLIT_REGEX);\n        const floatElement = new FloatElement({ vertical: true, align: options.align, wrap: false });\n        const textOptions = deepExtend({ }, options, { opacity: 1, animation: null });\n\n        this.container = floatElement;\n        this.append(floatElement);\n\n        for (let rowIdx = 0; rowIdx < rows.length; rowIdx++) {\n            let text = new Text(rows[rowIdx].trim(), textOptions);\n            floatElement.append(text);\n        }\n    }\n\n    reflow(targetBox) {\n        const options = this.options;\n        const visualFn = options.visual;\n        this.container.options.align = options.align;\n\n        if (visualFn && !this._boxReflow) {\n            let visualBox = targetBox;\n            if (!visualBox.hasSize()) {\n                this._boxReflow = true;\n                this.reflow(visualBox);\n                this._boxReflow = false;\n                visualBox = this.box;\n            }\n            const visual = this.visual = visualFn(this.visualContext(visualBox));\n\n            if (visual) {\n                visualBox = rectToBox(visual.clippedBBox() || new geom.Rect());\n\n                visual.options.zIndex = options.zIndex;\n                visual.options.noclip = options.noclip;\n            }\n\n            this.box = this.contentBox = this.paddingBox = visualBox;\n        } else {\n            super.reflow(targetBox);\n\n            if (options.rotation) {\n                const margin = getSpacing(options.margin);\n                let box = this.box.unpad(margin);\n\n                this.targetBox = targetBox;\n                this.normalBox = box.clone();\n\n                box = this.rotate();\n                box.translate(margin.left - margin.right, margin.top - margin.bottom);\n\n                this.rotatedBox = box.clone();\n\n                box.pad(margin);\n            }\n        }\n    }\n\n    createVisual() {\n        const options = this.options;\n\n        if (!options.visible) {\n            return;\n        }\n\n        this.visual = new draw.Group({\n            transform: this.rotationTransform(),\n            zIndex: options.zIndex,\n            noclip: options.noclip\n        });\n\n        if (this.hasBox()) {\n            const box = draw.Path.fromRect(this.paddingBox.toRect(), this.visualStyle());\n            this.visual.append(box);\n        }\n    }\n\n    renderVisual() {\n        if (this.options.visual) {\n            this.addVisual();\n            this.createAnimation();\n        } else {\n            super.renderVisual();\n        }\n    }\n\n    visualOptions() {\n        const options = this.options;\n        return {\n            background: options.background,\n            border: options.border,\n            color: options.color,\n            font: options.font,\n            margin: options.margin,\n            padding: options.padding,\n            visible: options.visible\n        };\n    }\n\n    visualContext(targetBox) {\n\n        return {\n            text: this.content,\n            rect: targetBox.toRect(),\n            sender: this.getSender(),\n            options: this.visualOptions(),\n            createVisual: () => {\n                this._boxReflow = true;\n                this.reflow(targetBox);\n                this._boxReflow = false;\n                return this.getDefaultVisual();\n            }\n        };\n    }\n\n    getDefaultVisual() {\n        this.createVisual();\n        this.renderChildren();\n        const visual = this.visual;\n        delete this.visual;\n        return visual;\n    }\n\n    rotate() {\n        const options = this.options;\n        this.box.rotate(options.rotation);\n        this.align(this.targetBox, X, options.align);\n        this.align(this.targetBox, Y, options.vAlign);\n        return this.box;\n    }\n\n    rotationTransform() {\n        const rotation = this.options.rotation;\n        if (!rotation) {\n            return null;\n        }\n\n        const { x: cx, y: cy } = this.normalBox.center();\n        const boxCenter = this.rotatedBox.center();\n\n        return geom.transform()\n                   .translate(boxCenter.x - cx, boxCenter.y - cy)\n                   .rotate(rotation, [ cx, cy ]);\n    }\n}\n\nexport default TextBox;"],"names":["const","super","let","this"],"mappings":"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"}