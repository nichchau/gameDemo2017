{"version":3,"file":"series-binder.js","sources":["series-binder.js"],"sourcesContent":["import getField from './utils/get-field';\nimport { VALUE } from '../common/constants';\nimport { Class, defined } from '../common';\n\nclass SeriesBinder extends Class {\n\n    constructor() {\n        super();\n\n        this._valueFields = {};\n        this._otherFields = {};\n        this._nullValue = {};\n        this._undefinedValue = {};\n    }\n\n    register(seriesTypes, valueFields = [ VALUE ], otherFields = {}) {\n\n        for (let i = 0; i < seriesTypes.length; i++) {\n            const type = seriesTypes[i];\n\n            this._valueFields[type] = valueFields;\n            this._otherFields[type] = otherFields;\n            this._nullValue[type] = this._makeValue(valueFields, null);\n            this._undefinedValue[type] = this._makeValue(valueFields, undefined);\n        }\n    }\n\n    canonicalFields(series) {\n        return this.valueFields(series).concat(this.otherFields(series));\n    }\n\n    valueFields(series) {\n        return this._valueFields[series.type] || [ VALUE ];\n    }\n\n    otherFields(series) {\n        return this._otherFields[series.type] || [ VALUE ];\n    }\n\n    bindPoint(series, pointIx, item) {\n        const data = series.data;\n        const pointData = defined(item) ? item : data[pointIx];\n        const result = { valueFields: { value: pointData } };\n        const valueFields = this.valueFields(series);\n        const otherFields = this._otherFields[series.type];\n        let fields, value;\n\n        if (pointData === null) {\n            value = this._nullValue[series.type];\n        } else if (!defined(pointData)) {\n            value = this._undefinedValue[series.type];\n        } else if (Array.isArray(pointData)) {\n            const fieldData = pointData.slice(valueFields.length);\n            value = this._bindFromArray(pointData, valueFields);\n            fields = this._bindFromArray(fieldData, otherFields);\n        } else if (typeof pointData === \"object\") {\n            const srcValueFields = this.sourceFields(series, valueFields);\n            const srcPointFields = this.sourceFields(series, otherFields);\n\n            value = this._bindFromObject(pointData, valueFields, srcValueFields);\n            fields = this._bindFromObject(pointData, otherFields, srcPointFields);\n        }\n\n        if (defined(value)) {\n            if (valueFields.length === 1) {\n                result.valueFields.value = value[valueFields[0]];\n            } else {\n                result.valueFields = value;\n            }\n        }\n\n        result.fields = fields || {};\n\n        return result;\n    }\n\n    _makeValue(fields, initialValue) {\n        const value = {};\n        const length = fields.length;\n\n        for (let i = 0; i < length; i++) {\n            const fieldName = fields[i];\n            value[fieldName] = initialValue;\n        }\n\n        return value;\n    }\n\n    _bindFromArray(array, fields) {\n        const value = {};\n\n        if (fields) {\n            const length = Math.min(fields.length, array.length);\n\n            for (let i = 0; i < length; i++) {\n                value[fields[i]] = array[i];\n            }\n        }\n\n        return value;\n    }\n\n    _bindFromObject(object, fields, srcFields = fields) {\n        const value = {};\n\n        if (fields) {\n            const length = fields.length;\n\n            for (let i = 0; i < length; i++) {\n                const fieldName = fields[i];\n                const srcFieldName = srcFields[i];\n                value[fieldName] = getField(srcFieldName, object);\n            }\n        }\n\n        return value;\n    }\n\n    sourceFields(series, canonicalFields) {\n        const sourceFields = [];\n\n        if (canonicalFields) {\n            const length = canonicalFields.length;\n\n            for (let i = 0; i < length; i++) {\n                const fieldName = canonicalFields[i];\n                const sourceFieldName = fieldName === VALUE ? \"field\" : fieldName + \"Field\";\n\n                sourceFields.push(series[sourceFieldName] || fieldName);\n            }\n        }\n\n        return sourceFields;\n    }\n}\n\nSeriesBinder.current = new SeriesBinder();\n\nexport default SeriesBinder;"],"names":["super","let","const","this"],"mappings":"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"}