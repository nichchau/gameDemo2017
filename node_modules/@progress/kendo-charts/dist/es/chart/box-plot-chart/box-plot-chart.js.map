{"version":3,"file":"box-plot-chart.js","sources":["box-plot-chart.js"],"sourcesContent":["import CandlestickChart from '../candlestick-chart/candlestick-chart';\nimport VerticalBoxPlot from './vertical-box-plot';\nimport BoxPlot from './box-plot';\nimport ClusterLayout from '../layout/cluster-layout';\n\nimport areNumbers from '../utils/are-numbers';\n\nimport { MIN_VALUE, MAX_VALUE } from '../../common/constants';\nimport { defined } from '../../common';\n\nclass BoxPlotChart extends CandlestickChart {\n    addValue(data, fields) {\n        const { categoryIx, category, series, seriesIx } = fields;\n        const { children, options } = this;\n        const value = data.valueFields;\n        const valueParts = this.splitValue(value);\n        const hasValue = areNumbers(valueParts);\n        const dataItem = series.data[categoryIx];\n        let categoryPoints = this.categoryPoints[categoryIx];\n        let point;\n\n        if (!categoryPoints) {\n            this.categoryPoints[categoryIx] = categoryPoints = [];\n        }\n\n        if (hasValue) {\n            point = this.createPoint(data, fields);\n        }\n\n        let cluster = children[categoryIx];\n        if (!cluster) {\n            cluster = new ClusterLayout({\n                vertical: options.invertAxes,\n                gap: options.gap,\n                spacing: options.spacing\n            });\n            this.append(cluster);\n        }\n\n        if (point) {\n            this.updateRange(value, fields);\n\n            cluster.append(point);\n\n            point.categoryIx = categoryIx;\n            point.category = category;\n            point.series = series;\n            point.seriesIx = seriesIx;\n            point.owner = this;\n            point.dataItem = dataItem;\n        }\n\n        this.points.push(point);\n        categoryPoints.push(point);\n    }\n\n    pointType() {\n        if (this.options.invertAxes) {\n            return VerticalBoxPlot;\n        }\n\n        return BoxPlot;\n    }\n\n    splitValue(value) {\n        return [\n            value.lower, value.q1, value.median,\n            value.q3, value.upper\n        ];\n    }\n\n    updateRange(value, fields) {\n        const axisName = fields.series.axis;\n        let axisRange = this.valueAxisRanges[axisName];\n        let parts = this.splitValue(value).concat(this.filterOutliers(value.outliers));\n\n        if (defined(value.mean)) {\n            parts = parts.concat(value.mean);\n        }\n\n        axisRange = this.valueAxisRanges[axisName] =\n            axisRange || { min: MAX_VALUE, max: MIN_VALUE };\n\n        axisRange = this.valueAxisRanges[axisName] = {\n            min: Math.min.apply(Math, parts.concat([ axisRange.min ])),\n            max: Math.max.apply(Math, parts.concat([ axisRange.max ]))\n        };\n    }\n\n    formatPointValue(point, format) {\n        const value = point.value;\n\n        return this.chartService.format.auto(format,\n            value.lower, value.q1, value.median,\n            value.q3, value.upper, value.mean, point.category\n        );\n    }\n\n    filterOutliers(items) {\n        const length = (items || []).length;\n        const result = [];\n\n        for (let i = 0; i < length; i++) {\n            const item = items[i];\n            if (defined(item) && item !== null) {\n                result.push(item);\n            }\n        }\n\n        return result;\n    }\n}\n\nexport default BoxPlotChart;"],"names":["const","let"],"mappings":"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"}