{"version":3,"file":"bubble-chart.js","sources":["bubble-chart.js"],"sourcesContent":["import ScatterChart from '../scatter-charts/scatter-chart';\nimport Bubble from './bubble';\n\nimport { INITIAL_ANIMATION_DURATION, BUBBLE } from '../constants';\n\nimport { MIN_VALUE, CIRCLE } from '../../common/constants';\nimport { deepExtend, isFunction, setDefaultOptions, valueOrDefault } from '../../common';\n\nclass BubbleChart extends ScatterChart {\n    _initFields() {\n        this._maxSize = MIN_VALUE;\n        super._initFields();\n    }\n\n    addValue(value, fields) {\n        if (value.size !== null && (value.size > 0 || (value.size < 0 && fields.series.negativeValues.visible))) {\n            this._maxSize = Math.max(this._maxSize, Math.abs(value.size));\n            super.addValue(value, fields);\n        } else {\n            this.points.push(null);\n            this.seriesPoints[fields.seriesIx].push(null);\n        }\n    }\n\n    reflow(box) {\n        this.updateBubblesSize(box);\n        super.reflow(box);\n    }\n\n    pointType() {\n        return Bubble;\n    }\n\n    createPoint(value, fields) {\n        const series = fields.series;\n        const pointsCount = series.data.length;\n        const delay = fields.pointIx * (INITIAL_ANIMATION_DURATION / pointsCount);\n        const animationOptions = {\n            delay: delay,\n            duration: INITIAL_ANIMATION_DURATION - delay,\n            type: BUBBLE\n        };\n\n        let color = fields.color || series.color;\n        if (value.size < 0 && series.negativeValues.visible) {\n            color = valueOrDefault(\n                series.negativeValues.color, color\n            );\n        }\n\n        let pointOptions = deepExtend({\n            labels: {\n                animation: {\n                    delay: delay,\n                    duration: INITIAL_ANIMATION_DURATION - delay\n                }\n            }\n        }, this.pointOptions(series, fields.seriesIx), {\n            markers: {\n                type: CIRCLE,\n                border: series.border,\n                opacity: series.opacity,\n                animation: animationOptions\n            }\n        });\n\n        pointOptions = this.evalPointOptions(pointOptions, value, fields);\n        if (isFunction(series.color)) {\n            color = pointOptions.color;\n        }\n\n        pointOptions.markers.background = color;\n\n        const point = new Bubble(value, pointOptions);\n        point.color = color;\n\n        this.append(point);\n\n        return point;\n    }\n\n    updateBubblesSize(box) {\n        const { options: { series } } = this;\n        const boxSize = Math.min(box.width(), box.height());\n\n        for (let seriesIx = 0; seriesIx < series.length; seriesIx++) {\n            const currentSeries = series[seriesIx];\n            const seriesPoints = this.seriesPoints[seriesIx];\n            const minSize = currentSeries.minSize || Math.max(boxSize * 0.02, 10);\n            const maxSize = currentSeries.maxSize || boxSize * 0.2;\n            const minR = minSize / 2;\n            const maxR = maxSize / 2;\n            const minArea = Math.PI * minR * minR;\n            const maxArea = Math.PI * maxR * maxR;\n            const areaRange = maxArea - minArea;\n            const areaRatio = areaRange / this._maxSize;\n\n            for (let pointIx = 0; pointIx < seriesPoints.length; pointIx++) {\n                const point = seriesPoints[pointIx];\n                if (point) {\n                    const area = Math.abs(point.value.size) * areaRatio;\n                    const radius = Math.sqrt((minArea + area) / Math.PI);\n                    const baseZIndex = valueOrDefault(point.options.zIndex, 0);\n                    const zIndex = baseZIndex + (1 - radius / maxR);\n\n                    deepExtend(point.options, {\n                        zIndex: zIndex,\n                        markers: {\n                            size: radius * 2,\n                            zIndex: zIndex\n                        },\n                        labels: {\n                            zIndex: zIndex + 1\n                        }\n                    });\n                }\n            }\n        }\n    }\n\n    formatPointValue(point, format) {\n        const value = point.value;\n        return this.chartService.format.auto(format, value.x, value.y, value.size, point.category);\n    }\n\n    createAnimation() {}\n    createVisual() {}\n}\n\nsetDefaultOptions(BubbleChart, {\n    tooltip: {\n        format: \"{3}\"\n    },\n    labels: {\n        format: \"{3}\"\n    }\n});\n\nexport default BubbleChart;"],"names":["super","const","let","this"],"mappings":"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"}