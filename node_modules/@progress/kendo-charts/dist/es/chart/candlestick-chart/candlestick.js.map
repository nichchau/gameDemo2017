{"version":3,"file":"candlestick.js","sources":["candlestick.js"],"sourcesContent":["import { drawing as draw, Color } from '@progress/kendo-drawing';\n\nimport { ChartElement, Point } from '../../core';\nimport PointEventsMixin from '../mixins/point-events-mixin';\nimport NoteMixin from '../mixins/note-mixin';\n\nimport { TOOLTIP_OFFSET } from '../constants';\nimport hasGradientOverlay from '../utils/has-gradient-overlay';\n\nimport { WHITE, LEFT, TOP } from '../../common/constants';\nimport { alignPathToPixel, deepExtend, defined, setDefaultOptions, valueOrDefault } from '../../common';\n\nclass Candlestick extends ChartElement {\n    constructor(value, options) {\n        super(options);\n        this.value = value;\n    }\n\n    reflow(box) {\n        const { options, value, owner: chart } = this;\n        const valueAxis = chart.seriesValueAxis(options);\n        const ocSlot = valueAxis.getSlot(value.open, value.close);\n        const lhSlot = valueAxis.getSlot(value.low, value.high);\n\n        ocSlot.x1 = lhSlot.x1 = box.x1;\n        ocSlot.x2 = lhSlot.x2 = box.x2;\n\n        this.realBody = ocSlot;\n\n        const mid = lhSlot.center().x;\n        const points = [];\n\n        points.push([ [ mid, lhSlot.y1 ], [ mid, ocSlot.y1 ] ]);\n        points.push([ [ mid, ocSlot.y2 ], [ mid, lhSlot.y2 ] ]);\n\n        this.lines = points;\n\n        this.box = lhSlot.clone().wrap(ocSlot);\n\n        if (!this._rendered) {\n            this._rendered = true;\n            this.createNote();\n        }\n\n        this.reflowNote();\n    }\n\n    reflowNote() {\n        if (this.note) {\n            this.note.reflow(this.box);\n        }\n    }\n\n    createVisual() {\n        super.createVisual();\n        this._mainVisual = this.mainVisual(this.options);\n        this.visual.append(\n            this._mainVisual\n        );\n\n        this.createOverlay();\n    }\n\n    mainVisual(options) {\n        const group = new draw.Group();\n\n        this.createBody(group, options);\n        this.createLines(group, options);\n\n        return group;\n    }\n\n    createBody(container, options) {\n        const body = draw.Path.fromRect(this.realBody.toRect(), {\n            fill: {\n                color: this.color,\n                opacity: options.opacity\n            },\n            stroke: null\n        });\n\n        if (options.border.width > 0) {\n            body.options.set(\"stroke\", {\n                color: this.getBorderColor(),\n                width: options.border.width,\n                dashType: options.border.dashType,\n                opacity: valueOrDefault(options.border.opacity, options.opacity)\n            });\n        }\n\n        alignPathToPixel(body);\n        container.append(body);\n\n        if (hasGradientOverlay(options)) {\n            container.append(this.createGradientOverlay(body, { baseColor: this.color }, deepExtend({\n                end: !options.vertical ? [ 0, 1 ] : undefined\n            }, options.overlay)));\n        }\n    }\n\n    createLines(container, options) {\n        this.drawLines(container, options, this.lines, options.line);\n    }\n\n    drawLines(container, options, lines, lineOptions) {\n        if (!lines) {\n            return;\n        }\n\n        const lineStyle = {\n            stroke: {\n                color: lineOptions.color || this.color,\n                opacity: valueOrDefault(lineOptions.opacity, options.opacity),\n                width: lineOptions.width,\n                dashType: lineOptions.dashType,\n                lineCap: \"butt\"\n            }\n        };\n\n        for (let i = 0; i < lines.length; i++) {\n            const line = draw.Path.fromPoints(lines[i], lineStyle);\n            alignPathToPixel(line);\n            container.append(line);\n        }\n    }\n\n    getBorderColor() {\n        const border = this.options.border;\n        let borderColor = border.color;\n\n        if (!defined(borderColor)) {\n            borderColor = new Color(this.color).brightness(border._brightness).toHex();\n        }\n\n        return borderColor;\n    }\n\n    createOverlay() {\n        const overlay = draw.Path.fromRect(this.box.toRect(), {\n            fill: {\n                color: WHITE,\n                opacity: 0\n            },\n            stroke: null\n        });\n\n        this.visual.append(overlay);\n    }\n\n    createHighlight() {\n        const highlight = this.options.highlight;\n        const normalColor = this.color;\n\n        this.color = highlight.color || this.color;\n        const overlay = this.mainVisual(\n            deepExtend({}, this.options, {\n                line: {\n                    color: this.getBorderColor()\n                }\n            }, highlight)\n        );\n        this.color = normalColor;\n\n        return overlay;\n    }\n\n    highlightVisual() {\n        return this._mainVisual;\n    }\n\n    highlightVisualArgs() {\n        return {\n            options: this.options,\n            rect: this.box.toRect(),\n            visual: this._mainVisual\n        };\n    }\n\n    tooltipAnchor() {\n        const box = this.box;\n        const clipBox = this.owner.pane.clipBox() || box;\n\n        return {\n            point: new Point(box.x2 + TOOLTIP_OFFSET, Math.max(box.y1, clipBox.y1) + TOOLTIP_OFFSET),\n            align: {\n                horizontal: LEFT,\n                vertical: TOP\n            }\n        };\n    }\n\n    formatValue(format) {\n        return this.owner.formatPointValue(this, format);\n    }\n\n    overlapsBox(box) {\n        return this.box.overlaps(box);\n    }\n}\n\nsetDefaultOptions(Candlestick, {\n    vertical: true,\n    border: {\n        _brightness: 0.8\n    },\n    line: {\n        width: 2\n    },\n    overlay: {\n        gradient: \"glass\"\n    },\n    tooltip: {\n        format: \"<table>\" +\n                    \"<tr><th colspan='2'>{4:d}</th></tr>\" +\n                    \"<tr><td>Open:</td><td>{0:C}</td></tr>\" +\n                    \"<tr><td>High:</td><td>{1:C}</td></tr>\" +\n                    \"<tr><td>Low:</td><td>{2:C}</td></tr>\" +\n                    \"<tr><td>Close:</td><td>{3:C}</td></tr>\" +\n                \"</table>\"\n    },\n    highlight: {\n        opacity: 1,\n        border: {\n            width: 1,\n            opacity: 1\n        },\n        line: {\n            width: 1,\n            opacity: 1\n        }\n    },\n    notes: {\n        visible: true,\n        label: {}\n    }\n});\n\ndeepExtend(Candlestick.prototype, PointEventsMixin);\ndeepExtend(Candlestick.prototype, NoteMixin);\n\nexport default Candlestick;"],"names":["super","const","let"],"mappings":"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"}