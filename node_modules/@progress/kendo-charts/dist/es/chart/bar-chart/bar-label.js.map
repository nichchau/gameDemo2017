{"version":3,"file":"bar-label.js","sources":["bar-label.js"],"sourcesContent":["import { ChartElement, TextBox, Box } from '../../core';\nimport { FADEIN, INITIAL_ANIMATION_DURATION, INSIDE_END, INSIDE_BASE, OUTSIDE_END } from '../constants';\n\nimport { CENTER, TOP, BOTTOM, LEFT, RIGHT, X, Y, BLACK } from '../../common/constants';\nimport { getSpacing, setDefaultOptions } from '../../common';\n\nclass BarLabel extends ChartElement {\n    constructor(content, options) {\n        super(options);\n\n        this.textBox = new TextBox(content, this.options);\n        this.append(this.textBox);\n    }\n\n    createVisual() {\n        this.textBox.options.noclip = this.options.noclip;\n    }\n\n    reflow(targetBox) {\n        const options = this.options;\n        const { vertical, aboveAxis } = options;\n        const text = this.children[0];\n        const textOptions = text.options;\n        const box = text.box;\n        const padding = text.options.padding;\n        let labelBox = targetBox;\n\n        textOptions.align = vertical ? CENTER : LEFT;\n        textOptions.vAlign = vertical ? TOP : CENTER;\n\n        if (options.position === INSIDE_END) {\n            if (vertical) {\n                textOptions.vAlign = TOP;\n\n                if (!aboveAxis && box.height() < targetBox.height()) {\n                    textOptions.vAlign = BOTTOM;\n                }\n            } else {\n                textOptions.align = aboveAxis ? RIGHT : LEFT;\n            }\n        } else if (options.position === CENTER) {\n            textOptions.vAlign = CENTER;\n            textOptions.align = CENTER;\n        } else if (options.position === INSIDE_BASE) {\n            if (vertical) {\n                textOptions.vAlign = aboveAxis ? BOTTOM : TOP;\n            } else {\n                textOptions.align = aboveAxis ? LEFT : RIGHT;\n            }\n        } else if (options.position === OUTSIDE_END) {\n            if (vertical) {\n                if (aboveAxis) {\n                    labelBox = new Box(\n                        targetBox.x1, targetBox.y1 - box.height(),\n                        targetBox.x2, targetBox.y1\n                    );\n                } else {\n                    labelBox = new Box(\n                        targetBox.x1, targetBox.y2,\n                        targetBox.x2, targetBox.y2 + box.height()\n                    );\n                }\n            } else {\n                textOptions.align = CENTER;\n                if (aboveAxis) {\n                    labelBox = new Box(\n                        targetBox.x2, targetBox.y1,\n                        targetBox.x2 + box.width(), targetBox.y2\n                    );\n                } else {\n                    labelBox = new Box(\n                        targetBox.x1 - box.width(), targetBox.y1,\n                        targetBox.x1, targetBox.y2\n                    );\n                }\n            }\n        }\n\n        if (!options.rotation) {\n            if (vertical) {\n                padding.left = padding.right =\n                    (labelBox.width() - text.contentBox.width()) / 2;\n            } else {\n                padding.top = padding.bottom =\n                    (labelBox.height() - text.contentBox.height()) / 2;\n            }\n        }\n\n        text.reflow(labelBox);\n    }\n\n    alignToClipBox(clipBox) {\n        const vertical = this.options.vertical;\n        const field = vertical ? Y : X;\n        const start = field + \"1\";\n        const end = field + \"2\";\n        const text = this.children[0];\n        const parentBox = this.parent.box;\n\n        if (parentBox[start] < clipBox[start] || clipBox[end] < parentBox[end]) {\n            const targetBox = text.paddingBox.clone();\n            targetBox[start] = Math.max(parentBox[start], clipBox[start]);\n            targetBox[end] = Math.min(parentBox[end], clipBox[end]);\n\n            this.reflow(targetBox);\n        }\n    }\n}\n\nsetDefaultOptions(BarLabel, {\n    position: OUTSIDE_END,\n    margin: getSpacing(3),\n    padding: getSpacing(4),\n    color: BLACK,\n    background: \"\",\n    border: {\n        width: 1,\n        color: \"\"\n    },\n    aboveAxis: true,\n    vertical: false,\n    animation: {\n        type: FADEIN,\n        delay: INITIAL_ANIMATION_DURATION\n    },\n    zIndex: 2\n});\n\nexport default BarLabel;"],"names":["super","const","let"],"mappings":"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"}