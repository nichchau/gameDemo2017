{"version":3,"file":"donut-chart.js","sources":["donut-chart.js"],"sourcesContent":["import PieChart from '../pie-chart/pie-chart';\nimport DonutSegment from './donut-segment';\n\nimport { INITIAL_ANIMATION_DURATION } from '../constants';\n\nimport { deepExtend, defined, setDefaultOptions, valueOrDefault } from '../../common';\n\nconst DONUT_SECTOR_ANIM_DELAY = 50;\n\nclass DonutChart extends PieChart {\n    addValue(value, sector, fields) {\n        const segmentOptions = deepExtend({}, fields.series, { index: fields.index });\n        this.evalSegmentOptions(segmentOptions, value, fields);\n\n        this.createLegendItem(value, segmentOptions, fields);\n\n        if (!value || fields.visible === false) {\n            return;\n        }\n\n        const segment = new DonutSegment(value, sector, segmentOptions);\n\n        Object.assign(segment, fields);\n        this.append(segment);\n        this.points.push(segment);\n    }\n\n    reflow(targetBox) {\n        const options = this.options;\n        const box = targetBox.clone();\n        const space = 5;\n        const minWidth = Math.min(box.width(), box.height());\n        const halfMinWidth = minWidth / 2;\n        const defaultPadding = minWidth - minWidth * 0.85;\n        const series = options.series;\n        const seriesCount = series.length;\n\n        let padding = valueOrDefault(options.padding, defaultPadding);\n        padding = padding > halfMinWidth - space ? halfMinWidth - space : padding;\n\n        let totalSize = halfMinWidth - padding;\n        let seriesWithoutSize = 0;\n        let holeSize;\n\n        for (let i = 0; i < seriesCount; i++) {\n            const currentSeries = series[i];\n            if (i === 0) {\n                if (defined(currentSeries.holeSize)) {\n                    holeSize = currentSeries.holeSize;\n                    totalSize -= currentSeries.holeSize;\n                }\n            }\n\n            if (defined(currentSeries.size)) {\n                totalSize -= currentSeries.size;\n            } else {\n                seriesWithoutSize++;\n            }\n\n            if (defined(currentSeries.margin) && i !== seriesCount - 1) {\n                totalSize -= currentSeries.margin;\n            }\n        }\n\n        if (!defined(holeSize)) {\n            const currentSize = (halfMinWidth - padding) / (seriesCount + 0.75);\n            holeSize = currentSize * 0.75;\n            totalSize -= holeSize;\n        }\n\n        let innerRadius = holeSize;\n        let margin = 0;\n        let size, radius;\n\n        this.seriesConfigs = [];\n\n        for (let i = 0; i < seriesCount; i++) {\n            const currentSeries = series[i];\n            size = valueOrDefault(currentSeries.size, totalSize / seriesWithoutSize);\n            innerRadius += margin;\n            radius = innerRadius + size;\n            this.seriesConfigs.push({ innerRadius: innerRadius, radius: radius });\n            margin = currentSeries.margin || 0;\n            innerRadius = radius;\n        }\n\n        super.reflow(targetBox);\n    }\n\n    animationDelay(categoryIndex, seriesIndex, seriesCount) {\n        return categoryIndex * DONUT_SECTOR_ANIM_DELAY +\n            (INITIAL_ANIMATION_DURATION * (seriesIndex + 1) / (seriesCount + 1));\n    }\n}\n\n\nsetDefaultOptions(DonutChart, {\n    startAngle: 90,\n    connectors: {\n        width: 2,\n        color: \"#939393\",\n        padding: 8\n    }\n});\n\nexport default DonutChart;"],"names":["const","i","currentSeries","let","this","super"],"mappings":"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"}