{"version":3,"file":"waterfall-chart.js","sources":["waterfall-chart.js"],"sourcesContent":["import BarChart from '../bar-chart/bar-chart';\nimport SeriesBinder from '../series-binder';\nimport WaterfallSegment from './waterfall-segment';\n\nimport categoriesCount from '../utils/categories-count';\n\nimport { isNumber } from '../../common';\n\nclass WaterfallChart extends BarChart {\n    render() {\n        super.render();\n        this.createSegments();\n    }\n\n    traverseDataPoints(callback) {\n        const series = this.options.series;\n        const categories = this.categoryAxis.options.categories || [];\n        const totalCategories = categoriesCount(series);\n        const isVertical = !this.options.invertAxes;\n\n        for (let seriesIx = 0; seriesIx < series.length; seriesIx++) {\n            const currentSeries = series[seriesIx];\n            let total = 0;\n            let runningTotal = 0;\n\n            for (let categoryIx = 0; categoryIx < totalCategories; categoryIx++) {\n                const data = SeriesBinder.current.bindPoint(currentSeries, categoryIx);\n                const value = data.valueFields.value;\n                const summary = data.fields.summary;\n                let from = total;\n                let to;\n\n                if (summary) {\n                    if (summary.toLowerCase() === \"total\") {\n                        data.valueFields.value = total;\n                        from = 0;\n                        to = total;\n                    } else {\n                        data.valueFields.value = runningTotal;\n                        to = from - runningTotal;\n                        runningTotal = 0;\n                    }\n                } else if (isNumber(value)) {\n                    runningTotal += value;\n                    total += value;\n                    to = total;\n                }\n\n                callback(data, {\n                    category: categories[categoryIx],\n                    categoryIx: categoryIx,\n                    series: currentSeries,\n                    seriesIx: seriesIx,\n                    total: total,\n                    runningTotal: runningTotal,\n                    from: from,\n                    to: to,\n                    isVertical: isVertical\n                });\n            }\n        }\n    }\n\n    updateRange(value, fields) {\n        super.updateRange({ value: fields.to }, fields);\n    }\n\n    aboveAxis(point) {\n        return point.value >= 0;\n    }\n\n    plotRange(point) {\n        return [ point.from, point.to ];\n    }\n\n    createSegments() {\n        const series = this.options.series;\n        const seriesPoints = this.seriesPoints;\n        const segments = this.segments = [];\n\n        for (let seriesIx = 0; seriesIx < series.length; seriesIx++) {\n            const currentSeries = series[seriesIx];\n            const points = seriesPoints[seriesIx];\n\n            if (points) {\n                let prevPoint;\n                for (let pointIx = 0; pointIx < points.length; pointIx++) {\n                    const point = points[pointIx];\n\n                    if (point && prevPoint) {\n                        const segment = new WaterfallSegment(prevPoint, point, currentSeries);\n                        segments.push(segment);\n                        this.append(segment);\n                    }\n\n                    prevPoint = point;\n                }\n            }\n        }\n    }\n}\n\nexport default WaterfallChart;"],"names":["super","const","let","this"],"mappings":"AAAA,OAAO,QAAQ,MAAM,wBAAwB,CAAC;AAC9C,OAAO,YAAY,MAAM,kBAAkB,CAAC;AAC5C,OAAO,gBAAgB,MAAM,qBAAqB,CAAC;;AAEnD,OAAO,eAAe,MAAM,2BAA2B,CAAC;;AAExD,SAAS,QAAQ,QAAQ,cAAc,CAAC;;AAExC,IAAM,cAAc,GAAiB;IAAC;;;;;;;;IAAA,AAClC,yBAAA,MAAM,mBAAA,GAAG;QACLA,kBAAK,CAAC,MAAM,KAAA,CAAC,IAAA,CAAC,CAAC;QACf,IAAI,CAAC,cAAc,EAAE,CAAC;KACzB,CAAA;;IAED,yBAAA,kBAAkB,+BAAA,CAAC,QAAQ,EAAE;QACzBC,GAAK,CAAC,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC;QACnCA,GAAK,CAAC,UAAU,GAAG,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,UAAU,IAAI,EAAE,CAAC;QAC9DA,GAAK,CAAC,eAAe,GAAG,eAAe,CAAC,MAAM,CAAC,CAAC;QAChDA,GAAK,CAAC,UAAU,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC;;QAE5C,KAAKC,GAAG,CAAC,QAAQ,GAAG,CAAC,EAAE,QAAQ,GAAG,MAAM,CAAC,MAAM,EAAE,QAAQ,EAAE,EAAE;YACzDD,GAAK,CAAC,aAAa,GAAG,MAAM,CAAC,QAAQ,CAAC,CAAC;YACvCC,GAAG,CAAC,KAAK,GAAG,CAAC,CAAC;YACdA,GAAG,CAAC,YAAY,GAAG,CAAC,CAAC;;YAErB,KAAKA,GAAG,CAAC,UAAU,GAAG,CAAC,EAAE,UAAU,GAAG,eAAe,EAAE,UAAU,EAAE,EAAE;gBACjED,GAAK,CAAC,IAAI,GAAG,YAAY,CAAC,OAAO,CAAC,SAAS,CAAC,aAAa,EAAE,UAAU,CAAC,CAAC;gBACvEA,GAAK,CAAC,KAAK,GAAG,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC;gBACrCA,GAAK,CAAC,OAAO,GAAG,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC;gBACpCC,GAAG,CAAC,IAAI,GAAG,KAAK,CAAC;gBACjBA,GAAG,CAAC,EAAE,CAAC;;gBAEP,IAAI,OAAO,EAAE;oBACT,IAAI,OAAO,CAAC,WAAW,EAAE,KAAK,OAAO,EAAE;wBACnC,IAAI,CAAC,WAAW,CAAC,KAAK,GAAG,KAAK,CAAC;wBAC/B,IAAI,GAAG,CAAC,CAAC;wBACT,EAAE,GAAG,KAAK,CAAC;qBACd,MAAM;wBACH,IAAI,CAAC,WAAW,CAAC,KAAK,GAAG,YAAY,CAAC;wBACtC,EAAE,GAAG,IAAI,GAAG,YAAY,CAAC;wBACzB,YAAY,GAAG,CAAC,CAAC;qBACpB;iBACJ,MAAM,IAAI,QAAQ,CAAC,KAAK,CAAC,EAAE;oBACxB,YAAY,IAAI,KAAK,CAAC;oBACtB,KAAK,IAAI,KAAK,CAAC;oBACf,EAAE,GAAG,KAAK,CAAC;iBACd;;gBAED,QAAQ,CAAC,IAAI,EAAE;oBACX,QAAQ,EAAE,UAAU,CAAC,UAAU,CAAC;oBAChC,UAAU,EAAE,UAAU;oBACtB,MAAM,EAAE,aAAa;oBACrB,QAAQ,EAAE,QAAQ;oBAClB,KAAK,EAAE,KAAK;oBACZ,YAAY,EAAE,YAAY;oBAC1B,IAAI,EAAE,IAAI;oBACV,EAAE,EAAE,EAAE;oBACN,UAAU,EAAE,UAAU;iBACzB,CAAC,CAAC;aACN;SACJ;KACJ,CAAA;;IAED,yBAAA,WAAW,wBAAA,CAAC,KAAK,EAAE,MAAM,EAAE;QACvBF,kBAAK,CAAC,WAAW,KAAA,CAAC,MAAA,EAAE,KAAK,EAAE,MAAM,CAAC,EAAE,EAAE,EAAE,MAAM,CAAC,CAAC;KACnD,CAAA;;IAED,yBAAA,SAAS,sBAAA,CAAC,KAAK,EAAE;QACb,OAAO,KAAK,CAAC,KAAK,IAAI,CAAC,CAAC;KAC3B,CAAA;;IAED,yBAAA,SAAS,sBAAA,CAAC,KAAK,EAAE;QACb,OAAO,EAAE,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,EAAE,CAAC;KACnC,CAAA;;IAED,yBAAA,cAAc,2BAAA,GAAG,CAAC;;AAAA;QACdC,GAAK,CAAC,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC;QACnCA,GAAK,CAAC,YAAY,GAAG,IAAI,CAAC,YAAY,CAAC;QACvCA,GAAK,CAAC,QAAQ,GAAG,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;;QAEpC,KAAKC,GAAG,CAAC,QAAQ,GAAG,CAAC,EAAE,QAAQ,GAAG,MAAM,CAAC,MAAM,EAAE,QAAQ,EAAE,EAAE;YACzDD,GAAK,CAAC,aAAa,GAAG,MAAM,CAAC,QAAQ,CAAC,CAAC;YACvCA,GAAK,CAAC,MAAM,GAAG,YAAY,CAAC,QAAQ,CAAC,CAAC;;YAEtC,IAAI,MAAM,EAAE;gBACRC,GAAG,CAAC,SAAS,CAAC;gBACd,KAAKA,GAAG,CAAC,OAAO,GAAG,CAAC,EAAE,OAAO,GAAG,MAAM,CAAC,MAAM,EAAE,OAAO,EAAE,EAAE;oBACtDD,GAAK,CAAC,KAAK,GAAG,MAAM,CAAC,OAAO,CAAC,CAAC;;oBAE9B,IAAI,KAAK,IAAI,SAAS,EAAE;wBACpBA,GAAK,CAAC,OAAO,GAAG,IAAI,gBAAgB,CAAC,SAAS,EAAE,KAAK,EAAE,aAAa,CAAC,CAAC;wBACtE,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;wBACvBE,MAAI,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;qBACxB;;oBAED,SAAS,GAAG,KAAK,CAAC;iBACrB;aACJ;SACJ;KACJ,CAAA,AACJ;;;EA5F4B,QA4F5B,GAAA;;AAED,eAAe,cAAc"}