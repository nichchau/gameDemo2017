{"version":3,"file":"pane.js","sources":["pane.js"],"sourcesContent":["import { ChartElement, BoxElement, Title, Box } from '../core';\nimport ChartContainer from './chart-container';\n\nimport { TOP, LEFT, X, Y } from '../common/constants';\nimport { append, deepExtend, isObject, last, setDefaultOptions } from '../common';\n\nclass Pane extends BoxElement {\n    constructor(options) {\n        super(options);\n\n        this.id = paneID();\n\n        this.createTitle();\n\n        this.content = new ChartElement();\n\n        this.chartContainer = new ChartContainer({}, this);\n        this.append(this.content);\n\n        this.axes = [];\n        this.charts = [];\n    }\n\n    createTitle() {\n        let titleOptions = this.options.title;\n        if (isObject(titleOptions)) {\n            titleOptions = deepExtend({}, titleOptions, {\n                align: titleOptions.position,\n                position: TOP\n            });\n        }\n\n        this.title = Title.buildTitle(titleOptions, this, Pane.prototype.options.title);\n    }\n\n    appendAxis(axis) {\n        this.content.append(axis);\n        this.axes.push(axis);\n        axis.pane = this;\n    }\n\n    appendChart(chart) {\n        if (this.chartContainer.parent !== this.content) {\n            this.content.append(this.chartContainer);\n        }\n\n        this.charts.push(chart);\n        this.chartContainer.append(chart);\n        chart.pane = this;\n    }\n\n    empty() {\n        const plotArea = this.parent;\n\n        if (plotArea) {\n            for (let i = 0; i < this.axes.length; i++) {\n                plotArea.removeAxis(this.axes[i]);\n            }\n\n            for (let i = 0; i < this.charts.length; i++) {\n                plotArea.removeChart(this.charts[i]);\n            }\n        }\n\n        this.axes = [];\n        this.charts = [];\n\n        this.content.destroy();\n        this.content.children = [];\n        this.chartContainer.children = [];\n    }\n\n    reflow(targetBox) {\n        // Content (such as charts) is rendered, but excluded from reflows\n        let content;\n        if (last(this.children) === this.content) {\n            content = this.children.pop();\n        }\n\n        super.reflow(targetBox);\n\n        if (content) {\n            this.children.push(content);\n        }\n\n        if (this.title) {\n            this.contentBox.y1 += this.title.box.height();\n        }\n    }\n\n    visualStyle() {\n        const style = super.visualStyle();\n        style.zIndex = -10;\n\n        return style;\n    }\n\n    renderComplete() {\n        if (this.options.visible) {\n            this.createGridLines();\n        }\n    }\n\n    stackRoot() {\n        return this;\n    }\n\n    clipRoot() {\n        return this;\n    }\n\n    createGridLines() {\n        const axes = this.axes;\n        const allAxes = axes.concat(this.parent.axes);\n        const vGridLines = [];\n        const hGridLines = [];\n\n        // TODO\n        // Is full combination really necessary?\n        for (let i = 0; i < axes.length; i++) {\n            const axis = axes[i];\n            const vertical = axis.options.vertical;\n            const gridLines = vertical ? vGridLines : hGridLines;\n            for (let j = 0; j < allAxes.length; j++) {\n                if (gridLines.length === 0) {\n                    const altAxis = allAxes[j];\n                    if (vertical !== altAxis.options.vertical) {\n                        append(gridLines, axis.createGridLines(altAxis));\n                    }\n                }\n            }\n        }\n    }\n\n    refresh() {\n        this.visual.clear();\n\n        this.content.parent = null;\n        this.content.createGradient = this.createGradient.bind(this);\n        this.content.renderVisual();\n        this.content.parent = this;\n\n        if (this.title) {\n            this.visual.append(this.title.visual);\n        }\n\n        this.visual.append(this.content.visual);\n\n        this.renderComplete();\n    }\n\n    chartsBox() {\n        const axes = this.axes;\n        const length = axes.length;\n        const chartsBox = new Box();\n\n        for (let idx = 0; idx < length; idx++) {\n            const axis = axes[idx];\n            const axisValueField = axis.options.vertical ? Y : X;\n            const lineBox = axis.lineBox();\n            chartsBox[axisValueField + 1] = lineBox[axisValueField + 1];\n            chartsBox[axisValueField + 2] = lineBox[axisValueField + 2];\n        }\n\n        if (chartsBox.x2 === 0) {\n            const allAxes = this.parent.axes;\n            const length = allAxes.length;\n\n            for (let idx = 0; idx < length; idx++) {\n                const axis = allAxes[idx];\n                if (!axis.options.vertical) {\n                    const lineBox = axis.lineBox();\n                    chartsBox.x1 = lineBox.x1;\n                    chartsBox.x2 = lineBox.x2;\n                }\n            }\n        }\n        return chartsBox;\n    }\n\n    clipBox() {\n        return this.chartContainer.clipBox;\n    }\n}\n\nlet ID = 1;\n\nfunction paneID() {\n    return \"pane\" + ID++;\n}\n\nPane.prototype.isStackRoot = true;\n\nsetDefaultOptions(Pane, {\n    zIndex: -1,\n    shrinkToFit: true,\n    title: {\n        align: LEFT\n    },\n    visible: true\n});\n\nexport default Pane;"],"names":["super","let","i","const","this","idx","axis","lineBox","length"],"mappings":"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"}