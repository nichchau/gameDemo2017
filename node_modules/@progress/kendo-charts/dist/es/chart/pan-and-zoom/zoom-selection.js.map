{"version":3,"file":"zoom-selection.js","sources":["zoom-selection.js"],"sourcesContent":["import acceptKey from './accept-key';\nimport toChartAxisRanges from './to-chart-axis-ranges';\n\nimport { X, Y } from '../../common/constants';\nimport { Class, deepExtend, elementStyles, elementOffset } from '../../common';\n\nclass ZoomSelection extends Class {\n    constructor(chart, options) {\n        super();\n\n        this.chart = chart;\n        this.options = deepExtend({}, this.options, options);\n        this.createElement();\n    }\n\n    createElement() {\n        const marquee = this._marquee = document.createElement(\"div\");\n        marquee.className = \"k-marquee\";\n        const marqueeColor = document.createElement(\"div\");\n        marqueeColor.className = \"k-marquee-color\";\n        marquee.appendChild(marqueeColor);\n    }\n\n    removeElement() {\n        if (this._marquee.parentNode) {\n            this._marquee.parentNode.removeChild(this._marquee);\n        }\n    }\n\n    setStyles(styles) {\n        elementStyles(this._marquee, styles);\n    }\n\n    start(e) {\n        if (acceptKey(e, this.options.key)) {\n            const chart = this.chart;\n            const point = chart._eventCoordinates(e);\n            const zoomPane = this._zoomPane = chart._plotArea.paneByPoint(point);\n            if (zoomPane && zoomPane.clipBox()) {\n                const clipBox = zoomPane.clipBox().clone();\n                const offset = this._elementOffset();\n\n                clipBox.translate(offset.left, offset.top);\n                this._zoomPaneClipBox = clipBox;\n\n                document.body.appendChild(this._marquee);\n                this.setStyles({\n                    left: e.pageX + 1,\n                    top: e.pageY + 1,\n                    width: 0,\n                    height: 0\n                });\n\n                return true;\n            }\n        }\n        return false;\n    }\n\n    _elementOffset() {\n        const chartElement = this.chart.element;\n        const { paddingLeft, paddingTop } = elementStyles(chartElement, [ \"paddingLeft\", \"paddingTop\" ]);\n        const offset = elementOffset(chartElement);\n\n        return {\n            left: paddingLeft + offset.left,\n            top: paddingTop + offset.top\n        };\n    }\n\n    move(e) {\n        const zoomPane = this._zoomPane;\n        if (zoomPane) {\n            this.setStyles(this._selectionPosition(e));\n        }\n    }\n\n    end(e) {\n        const zoomPane = this._zoomPane;\n        if (zoomPane) {\n            const elementOffset = this._elementOffset();\n            const selectionPosition = this._selectionPosition(e);\n            selectionPosition.left -= elementOffset.left;\n            selectionPosition.top -= elementOffset.top;\n\n            const start = { x: selectionPosition.left, y: selectionPosition.top };\n            const end = { x: selectionPosition.left + selectionPosition.width, y: selectionPosition.top + selectionPosition.height };\n            this._updateAxisRanges(start, end);\n\n            this.removeElement();\n            delete this._zoomPane;\n\n            return toChartAxisRanges(this.axisRanges);\n        }\n    }\n\n    zoom() {\n        const axisRanges = this.axisRanges;\n        if (axisRanges && axisRanges.length) {\n            const plotArea = this.chart._plotArea;\n            for (let idx = 0; idx < axisRanges.length; idx++) {\n                const axisRange = axisRanges[idx];\n                plotArea.updateAxisOptions(axisRange.axis, axisRange.range);\n            }\n            plotArea.redraw(plotArea.panes);\n        }\n    }\n\n    destroy() {\n        this.removeElement();\n        delete this._marquee;\n        delete this.chart;\n    }\n\n    _updateAxisRanges(start, end) {\n        const lock = (this.options.lock || \"\").toLowerCase();\n        const axisRanges = [];\n\n        const axes = this._zoomPane.axes;\n        for (let idx = 0; idx < axes.length; idx++) {\n            const axis = axes[idx];\n            const vertical = axis.options.vertical;\n            if (!(lock === X && !vertical) && !(lock === Y && vertical)) {\n                const range = axis.pointsRange(start, end);\n                if (range) {\n                    axisRanges.push({\n                        axis: axis,\n                        range: range\n                    });\n                }\n            }\n        }\n\n        this.axisRanges = axisRanges;\n    }\n\n    _selectionPosition(e) {\n        const clipBox = this._zoomPaneClipBox;\n        const startLocation = {\n            x: e.x.startLocation,\n            y: e.y.startLocation\n        };\n        const { x: { location: pageX }, y: { location: pageY } } = e;\n        const lock = (this.options.lock || \"\").toLowerCase();\n        let left = Math.min(startLocation.x, pageX);\n        let top = Math.min(startLocation.y, pageY);\n        let width = Math.abs(startLocation.x - pageX);\n        let height = Math.abs(startLocation.y - pageY);\n\n        if (lock === X) {\n            left = clipBox.x1;\n            width = clipBox.width();\n        }\n        if (lock === Y) {\n            top = clipBox.y1;\n            height = clipBox.height();\n        }\n\n        if (pageX > clipBox.x2) {\n            width = clipBox.x2 - startLocation.x;\n        }\n\n        if (pageX < clipBox.x1) {\n            width = startLocation.x - clipBox.x1;\n        }\n\n        if (pageY > clipBox.y2) {\n            height = clipBox.y2 - startLocation.y;\n        }\n\n        if (pageY < clipBox.y1) {\n            height = startLocation.y - clipBox.y1;\n        }\n\n        return {\n            left: Math.max(left, clipBox.x1),\n            top: Math.max(top, clipBox.y1),\n            width: width,\n            height: height\n        };\n    }\n}\n\nZoomSelection.prototype.options = {\n    key: \"shift\",\n    lock: \"none\"\n};\n\nexport default ZoomSelection;"],"names":["super","const","let"],"mappings":"AAAA,OAAO,SAAS,MAAM,cAAc,CAAC;AACrC,OAAO,iBAAiB,MAAM,wBAAwB,CAAC;;AAEvD,SAAS,CAAC,EAAE,CAAC,QAAQ,wBAAwB,CAAC;AAC9C,SAAS,KAAK,EAAE,UAAU,EAAE,aAAa,EAAE,aAAa,QAAQ,cAAc,CAAC;;AAE/E,IAAM,aAAa,GAAc;IAAC,AAC9B,sBAAW,CAAC,KAAK,EAAE,OAAO,EAAE;QACxBA,KAAK,KAAA,CAAC,IAAA,CAAC,CAAC;;QAER,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;QACnB,IAAI,CAAC,OAAO,GAAG,UAAU,CAAC,EAAE,EAAE,IAAI,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;QACrD,IAAI,CAAC,aAAa,EAAE,CAAC;KACxB;;;;wDAAA;;IAED,wBAAA,aAAa,0BAAA,GAAG;QACZC,GAAK,CAAC,OAAO,GAAG,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QAC9D,OAAO,CAAC,SAAS,GAAG,WAAW,CAAC;QAChCA,GAAK,CAAC,YAAY,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QACnD,YAAY,CAAC,SAAS,GAAG,iBAAiB,CAAC;QAC3C,OAAO,CAAC,WAAW,CAAC,YAAY,CAAC,CAAC;KACrC,CAAA;;IAED,wBAAA,aAAa,0BAAA,GAAG;QACZ,IAAI,IAAI,CAAC,QAAQ,CAAC,UAAU,EAAE;YAC1B,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,WAAW,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;SACvD;KACJ,CAAA;;IAED,wBAAA,SAAS,sBAAA,CAAC,MAAM,EAAE;QACd,aAAa,CAAC,IAAI,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;KACxC,CAAA;;IAED,wBAAA,KAAK,kBAAA,CAAC,CAAC,EAAE;QACL,IAAI,SAAS,CAAC,CAAC,EAAE,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,EAAE;YAChCA,GAAK,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;YACzBA,GAAK,CAAC,KAAK,GAAG,KAAK,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAC;YACzCA,GAAK,CAAC,QAAQ,GAAG,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC,SAAS,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;YACrE,IAAI,QAAQ,IAAI,QAAQ,CAAC,OAAO,EAAE,EAAE;gBAChCA,GAAK,CAAC,OAAO,GAAG,QAAQ,CAAC,OAAO,EAAE,CAAC,KAAK,EAAE,CAAC;gBAC3CA,GAAK,CAAC,MAAM,GAAG,IAAI,CAAC,cAAc,EAAE,CAAC;;gBAErC,OAAO,CAAC,SAAS,CAAC,MAAM,CAAC,IAAI,EAAE,MAAM,CAAC,GAAG,CAAC,CAAC;gBAC3C,IAAI,CAAC,gBAAgB,GAAG,OAAO,CAAC;;gBAEhC,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;gBACzC,IAAI,CAAC,SAAS,CAAC;oBACX,IAAI,EAAE,CAAC,CAAC,KAAK,GAAG,CAAC;oBACjB,GAAG,EAAE,CAAC,CAAC,KAAK,GAAG,CAAC;oBAChB,KAAK,EAAE,CAAC;oBACR,MAAM,EAAE,CAAC;iBACZ,CAAC,CAAC;;gBAEH,OAAO,IAAI,CAAC;aACf;SACJ;QACD,OAAO,KAAK,CAAC;KAChB,CAAA;;IAED,wBAAA,cAAc,2BAAA,GAAG;QACbA,GAAK,CAAC,YAAY,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC;QACxC,AAAK,AAA4B,OAAA,GAAG,aAAa,CAAC,YAAY,EAAE,EAAE,aAAa,EAAE,YAAY,EAAE,CAAC;QAAxF,IAAA,WAAW;QAAE,IAAA,UAAU,kBAAzB,AAAa,AAAY,AAAiE,AAAC;QACjGA,GAAK,CAAC,MAAM,GAAG,aAAa,CAAC,YAAY,CAAC,CAAC;;QAE3C,OAAO;YACH,IAAI,EAAE,WAAW,GAAG,MAAM,CAAC,IAAI;YAC/B,GAAG,EAAE,UAAU,GAAG,MAAM,CAAC,GAAG;SAC/B,CAAC;KACL,CAAA;;IAED,wBAAA,IAAI,iBAAA,CAAC,CAAC,EAAE;QACJA,GAAK,CAAC,QAAQ,GAAG,IAAI,CAAC,SAAS,CAAC;QAChC,IAAI,QAAQ,EAAE;YACV,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC,CAAC,CAAC,CAAC;SAC9C;KACJ,CAAA;;IAED,wBAAA,GAAG,gBAAA,CAAC,CAAC,EAAE;QACHA,GAAK,CAAC,QAAQ,GAAG,IAAI,CAAC,SAAS,CAAC;QAChC,IAAI,QAAQ,EAAE;YACVA,GAAK,CAAC,aAAa,GAAG,IAAI,CAAC,cAAc,EAAE,CAAC;YAC5CA,GAAK,CAAC,iBAAiB,GAAG,IAAI,CAAC,kBAAkB,CAAC,CAAC,CAAC,CAAC;YACrD,iBAAiB,CAAC,IAAI,IAAI,aAAa,CAAC,IAAI,CAAC;YAC7C,iBAAiB,CAAC,GAAG,IAAI,aAAa,CAAC,GAAG,CAAC;;YAE3CA,GAAK,CAAC,KAAK,GAAG,EAAE,CAAC,EAAE,iBAAiB,CAAC,IAAI,EAAE,CAAC,EAAE,iBAAiB,CAAC,GAAG,EAAE,CAAC;YACtEA,GAAK,CAAC,GAAG,GAAG,EAAE,CAAC,EAAE,iBAAiB,CAAC,IAAI,GAAG,iBAAiB,CAAC,KAAK,EAAE,CAAC,EAAE,iBAAiB,CAAC,GAAG,GAAG,iBAAiB,CAAC,MAAM,EAAE,CAAC;YACzH,IAAI,CAAC,iBAAiB,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC;;YAEnC,IAAI,CAAC,aAAa,EAAE,CAAC;YACrB,OAAO,IAAI,CAAC,SAAS,CAAC;;YAEtB,OAAO,iBAAiB,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;SAC7C;KACJ,CAAA;;IAED,wBAAA,IAAI,iBAAA,GAAG;QACHA,GAAK,CAAC,UAAU,GAAG,IAAI,CAAC,UAAU,CAAC;QACnC,IAAI,UAAU,IAAI,UAAU,CAAC,MAAM,EAAE;YACjCA,GAAK,CAAC,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC;YACtC,KAAKC,GAAG,CAAC,GAAG,GAAG,CAAC,EAAE,GAAG,GAAG,UAAU,CAAC,MAAM,EAAE,GAAG,EAAE,EAAE;gBAC9CD,GAAK,CAAC,SAAS,GAAG,UAAU,CAAC,GAAG,CAAC,CAAC;gBAClC,QAAQ,CAAC,iBAAiB,CAAC,SAAS,CAAC,IAAI,EAAE,SAAS,CAAC,KAAK,CAAC,CAAC;aAC/D;YACD,QAAQ,CAAC,MAAM,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;SACnC;KACJ,CAAA;;IAED,wBAAA,OAAO,oBAAA,GAAG;QACN,IAAI,CAAC,aAAa,EAAE,CAAC;QACrB,OAAO,IAAI,CAAC,QAAQ,CAAC;QACrB,OAAO,IAAI,CAAC,KAAK,CAAC;KACrB,CAAA;;IAED,wBAAA,iBAAiB,8BAAA,CAAC,KAAK,EAAE,GAAG,EAAE;QAC1BA,GAAK,CAAC,IAAI,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,IAAI,EAAE,CAAC,CAAC,WAAW,EAAE,CAAC;QACrDA,GAAK,CAAC,UAAU,GAAG,EAAE,CAAC;;QAEtBA,GAAK,CAAC,IAAI,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC;QACjC,KAAKC,GAAG,CAAC,GAAG,GAAG,CAAC,EAAE,GAAG,GAAG,IAAI,CAAC,MAAM,EAAE,GAAG,EAAE,EAAE;YACxCD,GAAK,CAAC,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC;YACvBA,GAAK,CAAC,QAAQ,GAAG,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC;YACvC,IAAI,CAAC,CAAC,IAAI,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,IAAI,KAAK,CAAC,IAAI,QAAQ,CAAC,EAAE;gBACzDA,GAAK,CAAC,KAAK,GAAG,IAAI,CAAC,WAAW,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC;gBAC3C,IAAI,KAAK,EAAE;oBACP,UAAU,CAAC,IAAI,CAAC;wBACZ,IAAI,EAAE,IAAI;wBACV,KAAK,EAAE,KAAK;qBACf,CAAC,CAAC;iBACN;aACJ;SACJ;;QAED,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC;KAChC,CAAA;;IAED,wBAAA,kBAAkB,+BAAA,CAAC,CAAC,EAAE;QAClBA,GAAK,CAAC,OAAO,GAAG,IAAI,CAAC,gBAAgB,CAAC;QACtCA,GAAK,CAAC,aAAa,GAAG;YAClB,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,aAAa;YACpB,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,aAAa;SACvB,CAAC;QACF,AAAK,AAAkB,IAAA,KAAK;QAAmB,IAAA,KAAK,gBAA9C,AAAK,AAAiB,AAAE,AAAK,AAAiB,AAAE,AAAE,AAAI,AAAC;QAC7DA,GAAK,CAAC,IAAI,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,IAAI,EAAE,CAAC,CAAC,WAAW,EAAE,CAAC;QACrDC,GAAG,CAAC,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC;QAC5CA,GAAG,CAAC,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC;QAC3CA,GAAG,CAAC,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC;QAC9CA,GAAG,CAAC,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC;;QAE/C,IAAI,IAAI,KAAK,CAAC,EAAE;YACZ,IAAI,GAAG,OAAO,CAAC,EAAE,CAAC;YAClB,KAAK,GAAG,OAAO,CAAC,KAAK,EAAE,CAAC;SAC3B;QACD,IAAI,IAAI,KAAK,CAAC,EAAE;YACZ,GAAG,GAAG,OAAO,CAAC,EAAE,CAAC;YACjB,MAAM,GAAG,OAAO,CAAC,MAAM,EAAE,CAAC;SAC7B;;QAED,IAAI,KAAK,GAAG,OAAO,CAAC,EAAE,EAAE;YACpB,KAAK,GAAG,OAAO,CAAC,EAAE,GAAG,aAAa,CAAC,CAAC,CAAC;SACxC;;QAED,IAAI,KAAK,GAAG,OAAO,CAAC,EAAE,EAAE;YACpB,KAAK,GAAG,aAAa,CAAC,CAAC,GAAG,OAAO,CAAC,EAAE,CAAC;SACxC;;QAED,IAAI,KAAK,GAAG,OAAO,CAAC,EAAE,EAAE;YACpB,MAAM,GAAG,OAAO,CAAC,EAAE,GAAG,aAAa,CAAC,CAAC,CAAC;SACzC;;QAED,IAAI,KAAK,GAAG,OAAO,CAAC,EAAE,EAAE;YACpB,MAAM,GAAG,aAAa,CAAC,CAAC,GAAG,OAAO,CAAC,EAAE,CAAC;SACzC;;QAED,OAAO;YACH,IAAI,EAAE,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,OAAO,CAAC,EAAE,CAAC;YAChC,GAAG,EAAE,IAAI,CAAC,GAAG,CAAC,GAAG,EAAE,OAAO,CAAC,EAAE,CAAC;YAC9B,KAAK,EAAE,KAAK;YACZ,MAAM,EAAE,MAAM;SACjB,CAAC;KACL,CAAA,AACJ;;;EA/K2B,KA+K3B,GAAA;;AAED,aAAa,CAAC,SAAS,CAAC,OAAO,GAAG;IAC9B,GAAG,EAAE,OAAO;IACZ,IAAI,EAAE,MAAM;CACf,CAAC;;AAEF,eAAe,aAAa"}