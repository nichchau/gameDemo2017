{"version":3,"file":"legend.js","sources":["legend.js"],"sourcesContent":["\nimport { ChartElement, BoxElement, Box } from '../../core';\nimport LegendLayout from './legend-layout';\nimport LegendItem from './legend-item';\n\nimport { TOP, RIGHT, BOTTOM, LEFT, CENTER, X, Y, BLACK } from '../../common/constants';\nimport { deepExtend, defined, getSpacing, inArray, setDefaultOptions } from '../../common';\n\nconst HORIZONTAL = \"horizontal\";\nconst POINTER = \"pointer\";\nconst CUSTOM = \"custom\";\n\nclass Legend extends ChartElement {\n    constructor(options, chartService) {\n        super(options);\n\n        this.chartService = chartService;\n\n        if (!inArray(this.options.position, [ TOP, RIGHT, BOTTOM, LEFT, CUSTOM ])) {\n            this.options.position = RIGHT;\n        }\n\n        this.createContainer();\n\n        this.createItems();\n    }\n\n    createContainer() {\n        const options = this.options;\n        const { position, align: userAlign } = options;\n        let align = position;\n        let vAlign = CENTER;\n\n        if (position === CUSTOM) {\n            align = LEFT;\n        } else if (inArray(position, [ TOP, BOTTOM ])) {\n            if (userAlign === \"start\") {\n                align = LEFT;\n            } else if (userAlign === \"end\") {\n                align = RIGHT;\n            } else {\n                align = CENTER;\n            }\n            vAlign = position;\n        } else if (userAlign) {\n            if (userAlign === \"start\") {\n                vAlign = TOP;\n            } else if (userAlign === \"end\") {\n                vAlign = BOTTOM;\n            }\n        }\n\n        this.container = new BoxElement({\n            margin: options.margin,\n            padding: options.padding,\n            background: options.background,\n            border: options.border,\n            vAlign: vAlign,\n            align: align,\n            zIndex: options.zIndex,\n            shrinkToFit: true\n        });\n\n        this.append(this.container);\n    }\n\n    createItems() {\n        const chartService = this.getService();\n        const options = this.options;\n        const vertical = this.isVertical();\n        const innerElement = new LegendLayout({\n            vertical: vertical,\n            spacing: options.spacing\n        }, chartService);\n        let items = options.items;\n\n        if (options.reverse) {\n            items = items.slice(0).reverse();\n        }\n\n        const count = items.length;\n\n        for (let i = 0; i < count; i++) {\n            let item = items[i];\n\n            innerElement.append(new LegendItem(deepExtend({}, {\n                markers: options.markers,\n                labels: options.labels\n            }, options.item, item)));\n        }\n\n        innerElement.render();\n\n        this.container.append(innerElement);\n    }\n\n    isVertical() {\n        const { orientation, position } = this.options;\n        const vertical = (position === CUSTOM && orientation !== HORIZONTAL) ||\n               (defined(orientation) ? orientation !== HORIZONTAL : inArray(position, [ LEFT, RIGHT ]));\n\n        return vertical;\n    }\n\n    hasItems() {\n        return this.container.children[0].children.length > 0;\n    }\n\n    reflow(targetBox) {\n        const options = this.options;\n        const legendBox = targetBox.clone();\n\n        if (!this.hasItems()) {\n            this.box = legendBox;\n            return;\n        }\n\n        if (options.position === CUSTOM) {\n            this.containerCustomReflow(legendBox);\n            this.box = legendBox;\n        } else {\n            this.containerReflow(legendBox);\n        }\n    }\n\n    containerReflow(targetBox) {\n        const { options, container } = this;\n        const { position, width, height } = options;\n        const pos = position === TOP || position === BOTTOM ? X : Y;\n        const vertical = this.isVertical();\n        const alignTarget = targetBox.clone();\n        let containerBox = targetBox.clone();\n\n        if (position === LEFT || position === RIGHT) {\n            containerBox.y1 = alignTarget.y1 = 0;\n        }\n\n        if (vertical && height) {\n            containerBox.y2 = containerBox.y1 + height;\n            containerBox.align(alignTarget, Y, container.options.vAlign);\n        } else if (!vertical && width) {\n            containerBox.x2 = containerBox.x1 + width;\n            containerBox.align(alignTarget, X, container.options.align);\n        }\n\n        container.reflow(containerBox);\n        containerBox = container.box;\n\n        const box = containerBox.clone();\n\n        if (options.offsetX || options.offsetY) {\n            containerBox.translate(options.offsetX, options.offsetY);\n            this.container.reflow(containerBox);\n        }\n\n        box[pos + 1] = targetBox[pos + 1];\n        box[pos + 2] = targetBox[pos + 2];\n\n        this.box = box;\n    }\n\n    containerCustomReflow(targetBox) {\n        const { options, container } = this;\n        const { offsetX, offsetY, width, height } = options;\n        const vertical = this.isVertical();\n        let containerBox = targetBox.clone();\n\n        if (vertical && height) {\n            containerBox.y2 = containerBox.y1 + height;\n        } else if (!vertical && width) {\n            containerBox.x2 = containerBox.x1 + width;\n        }\n        container.reflow(containerBox);\n        containerBox = container.box;\n\n        container.reflow(new Box(\n            offsetX, offsetY,\n            offsetX + containerBox.width(), offsetY + containerBox.height()\n        ));\n    }\n\n    renderVisual() {\n        if (this.hasItems()) {\n            super.renderVisual();\n        }\n    }\n}\n\nsetDefaultOptions(Legend, {\n    position: RIGHT,\n    items: [],\n    labels: {\n        margin: {\n            left: 6\n        }\n    },\n    offsetX: 0,\n    offsetY: 0,\n    margin: getSpacing(5),\n    padding: getSpacing(5),\n    border: {\n        color: BLACK,\n        width: 0\n    },\n    item: {\n        cursor: POINTER\n    },\n    spacing: 6,\n    background: \"\",\n    zIndex: 1,\n    markers: {\n        border: {\n            width: 0\n        },\n        width: 15,\n        height: 3,\n        type: \"rect\",\n        align: LEFT,\n        vAlign: CENTER\n    }\n});\n\nexport default Legend;"],"names":["const","super","let"],"mappings":"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"}