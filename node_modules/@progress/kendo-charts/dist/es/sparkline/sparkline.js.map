{"version":3,"file":"sparkline.js","sources":["sparkline.js"],"sourcesContent":["import { Chart } from '../chart';\nimport { BAR, BULLET, PIE, COLUMN, VERTICAL_BULLET } from '../chart/constants';\nimport{ addClass, deepExtend, elementSize, getSpacing, inArray, isArray, isNumber, setDefaultOptions } from '../common';\nimport SharedTooltip from './shared-tooltip';\n\nconst DEAULT_BAR_WIDTH = 150;\nconst DEAULT_BULLET_WIDTH = 150;\nconst NO_CROSSHAIR = [ BAR, BULLET ];\n\nfunction hide(children) {\n    const state = [];\n    for (let idx = 0; idx < children.length; idx++) {\n        const child = children[idx];\n        state[idx] = child.style.display;\n        child.style.display = \"none\";\n    }\n\n    return state;\n}\n\nfunction show(children, state) {\n    for (let idx = 0; idx < children.length; idx++) {\n        children[idx].style.display = state[idx];\n    }\n}\n\nfunction wrapNumber(value) {\n    return isNumber(value) ? [ value ] : value;\n}\n\nclass Sparkline extends Chart {\n    _setElementClass(element) {\n        addClass(element, 'k-sparkline');\n    }\n\n    _initElement(element) {\n        super._initElement(element);\n\n        this._initialWidth = Math.floor(elementSize(element).width);\n    }\n\n    _resize() {\n        const element = this.element;\n        const state = hide(element.childNodes);\n\n        this._initialWidth = Math.floor(elementSize(element).width);\n\n        show(element.childNodes, state);\n\n        super._resize();\n    }\n\n    _modelOptions() {\n        const chartOptions = this.options;\n        const stage = this._surfaceWrap();\n        const displayState = hide(stage.childNodes);\n\n        const space = document.createElement('span');\n        space.innerHTML = '&nbsp;';\n\n        stage.appendChild(space);\n\n        const options = deepExtend({\n            width: this._autoWidth,\n            height: elementSize(stage).height,\n            transitions: chartOptions.transitions\n        }, chartOptions.chartArea, {\n            inline: true,\n            align: false\n        });\n\n        elementSize(stage, {\n            width: options.width,\n            height: options.height\n        });\n\n        stage.removeChild(space);\n\n        show(stage.childNodes, displayState);\n        this.surface.resize();\n\n        return options;\n    }\n\n    _surfaceWrap() {\n        if (!this.stage) {\n            const stage = this.stage = document.createElement('span');\n            this.element.appendChild(stage);\n        }\n        return this.stage;\n    }\n\n    _createPlotArea(skipSeries) {\n        const plotArea = super._createPlotArea(skipSeries);\n        this._autoWidth = this._initialWidth || this._calculateWidth(plotArea);\n\n        return plotArea;\n    }\n\n    _calculateWidth(plotArea) {\n        const options = this.options;\n        const margin = getSpacing(options.chartArea.margin);\n        const charts = plotArea.charts;\n        const stage = this._surfaceWrap();\n        let total = 0;\n\n\n        for (let i = 0; i < charts.length; i++) {\n            const currentChart = charts[i];\n            const firstSeries = (currentChart.options.series || [])[0];\n            if (!firstSeries) {\n                continue;\n            }\n\n            if (firstSeries.type === BAR) {\n                return DEAULT_BAR_WIDTH;\n            }\n\n            if (firstSeries.type === BULLET) {\n                return DEAULT_BULLET_WIDTH;\n            }\n\n            if (firstSeries.type === PIE) {\n                return elementSize(stage).height;\n            }\n\n            const categoryAxis = currentChart.categoryAxis;\n            if (categoryAxis) {\n                const pointsCount = categoryAxis.options.categories.length *\n                    (!currentChart.options.isStacked && inArray(firstSeries.type, [ COLUMN, VERTICAL_BULLET ]) ? currentChart.seriesOptions.length : 1);\n\n                total = Math.max(total, pointsCount);\n            }\n        }\n\n        let size = total * options.pointWidth;\n        if (size > 0) {\n            size += margin.left + margin.right;\n        }\n\n        return size;\n    }\n\n    _createSharedTooltip(options) {\n        return new SharedTooltip(this._plotArea, options);\n    }\n\n    static normalizeOptions(userOptions) {\n        let options = wrapNumber(userOptions);\n\n        if (isArray(options)) {\n            options = { seriesDefaults: { data: options } };\n        } else {\n            options = deepExtend({}, options);\n        }\n\n        if (!options.series) {\n            options.series = [ { data: wrapNumber(options.data) } ];\n        }\n\n        deepExtend(options, {\n            seriesDefaults: {\n                type: options.type\n            }\n        });\n\n        if (inArray(options.series[0].type, NO_CROSSHAIR) ||\n            inArray(options.seriesDefaults.type, NO_CROSSHAIR)) {\n            options = deepExtend({}, {\n                categoryAxis: {\n                    crosshair: {\n                        visible: false\n                    }\n                }\n            }, options);\n        }\n\n        return options;\n    }\n}\n\nsetDefaultOptions(Sparkline, {\n    chartArea: {\n        margin: 2\n    },\n    axisDefaults: {\n        visible: false,\n        majorGridLines: {\n            visible: false\n        },\n        valueAxis: {\n            narrowRange: true\n        }\n    },\n    seriesDefaults: {\n        type: \"line\",\n        area: {\n            line: {\n                width: 0.5\n            }\n        },\n        bar: {\n            stack: true\n        },\n        padding: 2,\n        width: 0.5,\n        overlay: {\n            gradient: null\n        },\n        highlight: {\n            visible: false\n        },\n        border: {\n            width: 0\n        },\n        markers: {\n            size: 2,\n            visible: false\n        }\n    },\n    tooltip: {\n        visible: true,\n        shared: true\n    },\n    categoryAxis: {\n        crosshair: {\n            visible: true,\n            tooltip: {\n                visible: false\n            }\n        }\n    },\n    legend: {\n        visible: false\n    },\n    transitions: false,\n\n    pointWidth: 5,\n\n    panes: [ { clip: false } ]\n});\n\nexport default Sparkline;"],"names":["const","let","super"],"mappings":"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"}