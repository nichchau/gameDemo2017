{"version":3,"file":"stock-chart.js","sources":["stock-chart.js"],"sourcesContent":["import { Chart } from '../chart';\n\nimport Navigator from './navigator';\nimport { DEFAULT_WIDTH } from '../common/constants';\nimport { addClass, deepExtend, elementSize, grep, setDefaultOptions } from '../common';\nimport { NAVIGATOR_AXIS, NAVIGATOR_PANE } from './constants';\n\nconst AUTO_CATEGORY_WIDTH = 28;\n\nclass StockChart extends Chart {\n\n    applyDefaults(options, themeOptions) {\n        const width = elementSize(this.element).width || DEFAULT_WIDTH;\n        let theme = themeOptions;\n\n        const stockDefaults = {\n            seriesDefaults: {\n                categoryField: options.dateField\n            },\n            axisDefaults: {\n                categoryAxis: {\n                    name: \"default\",\n                    majorGridLines: {\n                        visible: false\n                    },\n                    labels: {\n                        step: 2\n                    },\n                    majorTicks: {\n                        visible: false\n                    },\n                    maxDateGroups: Math.floor(width / AUTO_CATEGORY_WIDTH)\n                }\n            }\n        };\n\n        if (theme) {\n            theme = deepExtend({}, theme, stockDefaults);\n        }\n\n        Navigator.setup(options, theme);\n\n        super.applyDefaults(options, theme);\n    }\n\n    _setElementClass(element) {\n        addClass(element, 'k-chart k-stockchart');\n    }\n\n    setOptions(options) {\n        this.destroyNavigator();\n        super.setOptions(options);\n    }\n\n    _resize() {\n        const transitions = this.options.transitions;\n\n        this.options.transitions = false;\n        this._fullRedraw();\n        this.options.transitions = transitions;\n    }\n\n    _redraw() {\n        const navigator = this.navigator;\n\n        if (!this._dirty() && navigator && navigator.options.partialRedraw) {\n            navigator.redrawSlaves();\n        } else {\n            this._fullRedraw();\n        }\n    }\n\n    _dirty() {\n        const options = this.options;\n        const series = [].concat(options.series, options.navigator.series);\n        const seriesCount = grep(series, function(s) { return s && s.visible; }).length;\n        const dirty = this._seriesCount !== seriesCount;\n        this._seriesCount = seriesCount;\n\n        return dirty;\n    }\n\n    _fullRedraw() {\n        let navigator = this.navigator;\n\n        if (!navigator) {\n            navigator = this.navigator = new Navigator(this);\n            this.trigger(\"navigatorCreated\", { navigator: navigator });\n        }\n\n        navigator.setRange();\n        super._redraw();\n        navigator.initSelection();\n    }\n\n    _trackSharedTooltip(coords) {\n        const plotArea = this._plotArea;\n        const pane = plotArea.paneByPoint(coords);\n\n        if (pane && pane.options.name === NAVIGATOR_PANE) {\n            this._unsetActivePoint();\n        } else {\n            super._trackSharedTooltip(coords);\n        }\n    }\n\n    bindCategories() {\n        super.bindCategories();\n        this.copyNavigatorCategories();\n    }\n\n    copyNavigatorCategories() {\n        const definitions = [].concat(this.options.categoryAxis);\n        let categories;\n\n        for (let axisIx = 0; axisIx < definitions.length; axisIx++) {\n            const axis = definitions[axisIx];\n            if (axis.name === NAVIGATOR_AXIS) {\n                categories = axis.categories;\n            } else if (categories && axis.pane === NAVIGATOR_PANE) {\n                axis.categories = categories;\n            }\n        }\n    }\n\n    destroyNavigator() {\n        if (this.navigator) {\n            this.navigator.destroy();\n            this.navigator = null;\n        }\n    }\n\n    destroy() {\n        this.destroyNavigator();\n        super.destroy();\n    }\n\n    _stopDragEvent(e) {\n        const coords = this._eventCoordinates(e);\n        const pane = this._plotArea.paneByPoint(coords);\n\n        return super._stopDragEvent(e) || (pane && pane.options.name === NAVIGATOR_PANE);\n    }\n}\n\nsetDefaultOptions(StockChart, {\n    dateField: \"date\",\n    axisDefaults: {\n        categoryAxis: {\n            type: \"date\",\n            baseUnit: \"fit\",\n            justified: true\n        },\n        valueAxis: {\n            narrowRange: true,\n            labels: {\n                format: \"C\"\n            }\n        }\n    },\n    navigator: {\n        select: {},\n        seriesDefaults: {\n            markers: {\n                visible: false\n            },\n            tooltip: {\n                visible: true\n            },\n            line: {\n                width: 2\n            }\n        },\n        hint: {},\n        visible: true\n    },\n    tooltip: {\n        visible: true\n    },\n    legend: {\n        visible: false\n    }\n});\n\nexport default StockChart;"],"names":["const","let","super"],"mappings":"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"}