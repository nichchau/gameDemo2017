{"version":3,"file":"text-metrics.js","sources":["text-metrics.js"],"sourcesContent":["import LRUCache from './lru-cache';\nimport { Class } from '../common';\nimport { objectKey, hashKey } from './util';\n\nfunction zeroSize() {\n    return { width: 0, height: 0, baseline: 0 };\n}\n\nconst DEFAULT_OPTIONS = {\n    baselineMarkerSize: 1\n};\n\nlet defaultMeasureBox;\n\nif (typeof document !== \"undefined\") {\n    defaultMeasureBox = document.createElement(\"div\");\n    defaultMeasureBox.style.cssText = \"position: absolute !important; top: -4000px !important; width: auto !important; height: auto !important;\" +\n              \"padding: 0 !important; margin: 0 !important; border: 0 !important;\" +\n              \"line-height: normal !important; visibility: hidden !important; white-space: nowrap!important;\";\n}\n\nclass TextMetrics extends Class {\n    constructor(options) {\n        super();\n\n        this._cache = new LRUCache(1000);\n        this.options = Object.assign({}, DEFAULT_OPTIONS, options);\n    }\n\n    measure(text, style, box) {\n        if (!text) {\n            return zeroSize();\n        }\n\n        const styleKey = objectKey(style);\n        const cacheKey = hashKey(text + styleKey);\n        const cachedResult = this._cache.get(cacheKey);\n\n        if (cachedResult) {\n            return cachedResult;\n        }\n\n        const size = zeroSize();\n        const measureBox = box || defaultMeasureBox;\n        const baselineMarker = this._baselineMarker().cloneNode(false);\n\n        for (let key in style) {\n            let value = style[key];\n            if (typeof value !== \"undefined\") {\n                measureBox.style[key] = value;\n            }\n        }\n\n        measureBox.textContent = text;\n        measureBox.appendChild(baselineMarker);\n        document.body.appendChild(measureBox);\n\n        if (String(text).length) {\n            size.width = measureBox.offsetWidth - this.options.baselineMarkerSize;\n            size.height = measureBox.offsetHeight;\n            size.baseline = baselineMarker.offsetTop + this.options.baselineMarkerSize;\n        }\n\n        if (size.width > 0 && size.height > 0) {\n            this._cache.put(cacheKey, size);\n        }\n\n        measureBox.parentNode.removeChild(measureBox);\n\n        return size;\n    }\n\n    _baselineMarker() {\n        const marker = document.createElement(\"div\");\n        marker.style.cssText = \"display: inline-block; vertical-align: baseline;width: \" +\n            this.options.baselineMarkerSize + \"px; height: \" + this.options.baselineMarkerSize + \"px;overflow: hidden;\";\n\n        return marker;\n    }\n}\n\nTextMetrics.current = new TextMetrics();\n\nexport default TextMetrics;"],"names":["const","let","super"],"mappings":"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"}